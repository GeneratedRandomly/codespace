# PA2 报告
### 仲嘉暄 计35 2023010812
## 曲线性质
Bezier 和 B 样条都基于用若干空间点（称为控制点）和基函数并进行采样生成曲线的思路。  
从外观上来看，B 样条曲线起止点和其首末控制点不重合，而 Bezier 的这些点重合。  
从基函数性质来看，B 样条曲线的控制点个数和阶数没有必然联系，而 Bezier 曲线的阶数是控制点个数减 1.  
从数学性质来看，B 样条曲线还具有局部支撑性，Bezier 则是全局的。  
从代码长度来看，B 样条曲线递推稍微复杂，Bezier 则较简单。  
从组成上看，B 样条曲线需要 `n`、 `k` 的值和节点、控制点列表，而 Bezier 只需要控制点列表。  
虽然设计 B 样条的节点列表为 `[0,0,0,0,...,1,1,1,1]` 可以使之成为 Bezier 曲线，但这样会使得 `Bernstein` 基函数类的运算十分复杂，影响效率和可读性。所以我不认为这是 B 样条和 Bezier 曲线一个很实际的关系，故不列入异同。  
绘制一个首尾相接且接点处也有连续性质的 B 样条：由于 $t\in[t_i,t_{i+1}]$ 上的曲线仅由至多 k 个控制点决定，所以如果我们让最前面 k 个控制点和最后面 k 个控制点依次相同（$P_0=P_{n-k+1},P_1=P_{n-k+2},\ldots,P_{k-1}=P_n$），则首尾应该是相接的。而 $B'_{i,p}(t)=p(\dfrac{B_{i,p-1}(t)}{t_{i+p}-t_i}-\dfrac{B_{i+1,p-1}(t)}{t_{i+p+1}-t_{i+1}})$，所以可以认为B样条曲线的导函数曲线是由控制点 $\dfrac{p}{t_p-t_0}(P_{i}-P_{i+1})$ 所组成的 B 样条曲线。因此，在首尾相接处应是 $C^{k-1}$ 连续。当然，要求节点是均匀的。
## 旋转代码逻辑
首先确保曲线在 xy 平面上。  
在画图的时候，先设置一个 `Surface` 结构体，用来存储这个曲线旋转产生表面相关信息。先把曲线离散化，对曲线的每个离散点，把旋转 360 度分为 40 个步长（steps = 40），就可以生成围绕 y 轴不同的旋转角。（`rot.setAxisAngle(t * 2 * 3.14159, Vector3f::UP);`）先把顶点 V 绕旋转轴旋转，再用叉乘算出法向量，旋转法向量。最后，把这些旋转后的点和向量存到 `surface` 里面。最后放两个三角形，分别是（下一曲线点的当前点、当前曲线点的下一个点、当前曲线点的当前点）和（下一曲线点的当前点、下一曲线点的下一个点、当前曲线点的下一点）。这两个正好是这四个点所有的三角形。
## Honor Code0
阅读了[学长PA3代码](https://github.com/Guangxuan-Xiao/THU-Computer-Graphics-2020/tree/master/PA3)但实现的区别比较大。  
绘制一个首尾相接且接点处也有连续性质的 B 样条时，参考了[B-spline Curves: Closed Curves](https://www.cnblogs.com/icmzn/p/5100789.html)部分博客。  
画Bezier的导数，参考了[贝塞尔曲线的导数仍然是贝塞尔曲线](https://zhuanlan.zhihu.com/p/688186803)一节。
## 遇到的问题
在实现过程中我发现 Bernstein 基函数的 evaluate 非常复杂，难以读懂，最终放弃，转为自己重写 Bezier 和 Bspline 各自的基函数，优化了效率，且增加了可读性。
## 建议
可以考虑不要把 Bezier 和 B 样条的基函数统一起来写成一个 python 代码，只从数学上说明 B 样条是 Bezier 的一个推广即可，然后给出 Bezier 和 B 样条各自的函数、导函数递推式即可让大家自己写，而不需要给一个参考 python 文件。